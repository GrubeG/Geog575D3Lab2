!function(){var t,e,a;window.onload=(t=d3.select("body").append("svg").attr("class","map").attr("width",800).attr("height",600),e=d3.geoAlbers().center([-10,50.78]).rotate([-20.8,0,0]).parallels([20.5,33.5]).scale(1100).translate([400,300]),a=d3.geoPath().projection(e),void d3.queue().defer(d3.csv,"data/EnvironmentalStatisticsEUFinal.csv").defer(d3.json,"data/RegionalCountries.topojson").defer(d3.json,"data/EUCountries.topojson").await((function(e,n,r,o){!function(t,e){var a=d3.geoGraticule().step([5,5]);t.append("path").datum(a.outline()).attr("class","gratBackground").attr("d",e),t.selectAll(".gratLines").data(a.lines()).enter().append("path").attr("class","gratLines").attr("d",e)}(t,a);var s=topojson.feature(r,r.objects.RegionalCountries),i=topojson.feature(o,o.objects.EUCountries).features;t.append("path").datum(s).attr("class","regional").attr("d",a),i=function(t,e){for(var a=["GHG","Waste","TotalEner","NonRenewEner","WaterAbsAvg"],n=0;n<e.length;n++)for(var r=e[n],o=r.Code,s=0;s<t.length;s++){var i=t[s].properties;i.GeogCode==o&&a.forEach((function(t){var e=parseFloat(r[t]);i[t]=e}))}return t}(i,n);var d=function(t){var e=["#D4B9DA","#C994C7","#DF65B0","#DD1C77","#980043"],a=d3.scaleQuantile().range(e),n=(a=d3.scaleQuantile().range(e),[d3.min(t,(function(t){return parseFloat(t.GHG)})),d3.max(t,(function(t){return parseFloat(t.GHG)}))]);return a.domain(n),a}(n);!function(t,e,a,n){e.selectAll(".EuropeanUnionCountries").data(t).enter().append("path").attr("class",(function(t){return"EuropeanUnionCountries "+t.properties.GeogCode})).attr("d",a).style("fill",(function(t){return function(t,e){var a=parseFloat(t.GHG);return"number"!=typeof a||isNaN(a)?"#CCC":e(a)}(t.properties,n)}))}(i,t,a,d)})))}();