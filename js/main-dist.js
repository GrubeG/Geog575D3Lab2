!function(){var t,e,n,r,a=["Greenhouse_Gases","Total_Waste","Total_Energy_Use","Non_Renewable_Energy_Use","Freshwater_Abstractions","Air_Quality"],o=a[0],s=.425*window.innerWidth,i=s-25-2,l=d3.scaleLinear().range([463,0]).domain([0,100]);function u(t,e){o=t;var n=c(e),r=(d3.selectAll(".EuropeanUnionCountries").transition().duration(1e3).style("fill",(function(t){return p(t.properties,n)})),d3.selectAll(".bar").sort((function(t,e){return e[o]-t[o]})).transition().delay((function(t,e){return 20*e})).duration(500)),a=d3.selectAll(".numbers").sort((function(t,e){return e[o]-t[o]})).transition().delay((function(t,e){return 20*e})).duration(500);d(r,e.length,n,a)}function d(t,e,n,r){t.attr("x",(function(t,n){return n*(i/e)+25})).attr("height",(function(t,e){return 463-l(parseFloat(t[o]))})).attr("y",(function(t,e){return l(parseFloat(t[o]))+5})).style("fill",(function(t){return p(t,n)})),r.attr("x",(function(t,n){return n*(i/e)+35})).attr("height",(function(t,e){return 463-l(parseFloat(t[o]))})).attr("y",(function(t,e){return l(parseFloat(t[o]))+20})).text((function(t){return t[o]}));d3.select(".chartTitle").text(o+" Per capita")}function c(t){var e=d3.scaleQuantile().range(["#1a9850","#91cf60","#d9ef8b","#fee08b","#fc8d59","#d73027"]),n=[d3.min(t,(function(t){return parseFloat(t[o])})),d3.max(t,(function(t){return parseFloat(t[o])}))];return e.domain(n),e}function p(t,e){var n=parseFloat(t[o]);return"number"!=typeof n||isNaN(n)?"#CCC":e(n)}function f(t){d3.selectAll("."+t.Code).style("stroke","cyan").style("stroke-width","2");g(t)}function h(t){d3.selectAll("."+t.Code).style("stroke","black").style("stroke-width","1"),d3.select(".infolabel").remove()}function g(t){var e="<h1>"+t[o]+"</h1><b>"+o+"</b>";d3.select("body").append("div").attr("class","infolabel").attr("id",t.Code+"_label").html(e).append("div").attr("class","labelname").html(t.Country)}function v(){var t=d3.select(".infolabel").node().getBoundingClientRect().width,e=d3.event.clientX+10,n=d3.event.clientY-75,r=d3.event.clientX-t-10,a=d3.event.clientY+25,o=d3.event.clientX>window.innerWidth-t-20?r:e,s=d3.event.clientY<75?a:n;d3.select(".infolabel").style("left",o+"px").style("top",s+"px")}window.onload=(t=.5*window.innerWidth,e=d3.select("body").append("svg").attr("class","map").attr("width",t).attr("height",600),n=d3.geoAlbers().center([-10,50.78]).rotate([-20.8,0,0]).parallels([20.5,33.5]).scale(1100).translate([t/2,300]),r=d3.geoPath().projection(n),void d3.queue().defer(d3.csv,"data/EnvironmentalStatisticsEUFinal.csv").defer(d3.json,"data/RegionalCountries.topojson").defer(d3.json,"data/EUCountries.topojson").await((function(t,n,s,i){!function(t,e){var n=d3.geoGraticule().step([5,5]);t.append("path").datum(n.outline()).attr("class","gratBackground").attr("d",e),t.selectAll(".gratLines").data(n.lines()).enter().append("path").attr("class","gratLines").attr("d",e)}(e,r);var l=topojson.feature(s,s.objects.RegionalCountries),m=topojson.feature(i,i.objects.EUCountries).features;e.append("path").datum(l).attr("class","regional").attr("d",r),m=function(t,e){for(var n=["Greenhouse_Gases","Total_Waste","Total_Energy_Use","Non_Renewable_Energy_Use","Freshwater_Abstractions","Air_Quality"],r=0;r<e.length;r++)for(var a=e[r],o=a.Code,s=0;s<t.length;s++){var i=t[s].properties;i.Code==o&&n.forEach((function(t){var e=parseFloat(a[t]);i[t]=e}))}return t}(m,n);var b=c(n);!function(t,e,n,r){e.selectAll(".EuropeanUnionCountries").data(t).enter().append("path").attr("class",(function(t){return"EuropeanUnionCountries "+t.properties.Code})).attr("d",n).style("fill",(function(t){return p(t.properties,r)})).on("mouseover",(function(t){f(t.properties)})).on("mouseout",(function(t){h(t.properties)})).on("mousemove",v).append("desc").text('{"stroke": "#000", "stroke-width": "0.5px"}')}(m,e,r,b),function(t,e){var n=.425*window.innerWidth,r=473,a=25,s=5,i=n-a-2,l=r-2*s,u="translate("+a+","+s+")",c=d3.select("body").append("svg").attr("width",n).attr("height",r).attr("class","chart"),p=(c.append("rect").attr("class","chartBackground").attr("width",i).attr("height",l).attr("transform",u),d3.scaleLinear().range([463,0]).domain([0,100]));console.log(d3.max(t,(function(t){return parseFloat(t[o])})));var g=c.selectAll(".bar").data(t).enter().append("rect").sort((function(t,e){return e[o]-t[o]})).attr("class",(function(t){return"bar "+t.Code})).attr("width",i/t.length-1).on("mouseover",f).on("mouseout",h).on("mousemove",v),m=(g.append("desc").text('{"stroke": "none", "stroke-width": "0px"}'),c.selectAll(".numbers").data(t).enter().append("text").sort((function(t,e){return e[o]-t[o]})).attr("class",(function(t){return"numbers "+t.Code})).attr("text-anchor","middle").attr("width",i/t.length-1).attr("x",(function(e,n){return n*(i/t.length)+35})).attr("height",(function(t,e){return 463-p(parseFloat(t[o]))})).attr("y",(function(t,e){return p(parseFloat(t[o]))+20})).text((function(t){return t[o]})).on("mouseover",f).on("mouseout",h).on("mousemove",v)),b=(c.append("text").attr("x",40).attr("y",40).attr("class","chartTitle").text("Per Capita "+o+" in each country"),d3.axisLeft(p));c.append("g").attr("class","axis").attr("transform",u).call(b),c.append("rect").attr("class","chartFrame").attr("width",i).attr("height",l).attr("transform",u),d(g,t.length,e,m)}(n,b),function(t){var e=d3.select("body").append("select").attr("class","dropdown").on("change",(function(){u(this.value,t)}));e.append("option").attr("class","titleOption").attr("disabled","true").text("Select Attribute"),e.selectAll("attrOptions").data(a).enter().append("option").attr("value",(function(t){return t})).text((function(t){return t})),g(props)}(n),u(n)})))}();