!function(){var t,e,r,n,a=["GHG","Waste","TotalEner","NonRenewEner","WaterAbsAvg"],o=a[0];function i(t,e){o=t;var r=s(e);d3.selectAll(".EuropeanUnionCountries").style("fill",(function(t){return l(t.properties,r)})),d3.selectAll(".bar").sort((function(t,e){return e[o]-t[o]})).attr("x",(function(t,r){return r*(chartInnerWidth/e.length)+leftPadding})).attr("height",(function(t,e){return 463-yScale(parseFloat(t[o]))})).attr("y",(function(t,e){return yScale(parseFloat(t[o]))+topBottomPadding})).style("fill",(function(t){return l(t,r)}))}function s(t){var e=["#1a9850","#91cf60","#d9ef8b","#fee08b","#fc8d59","#d73027"],r=d3.scaleQuantile().range(e),n=(r=d3.scaleQuantile().range(e),[d3.min(t,(function(t){return parseFloat(t[o])})),d3.max(t,(function(t){return parseFloat(t[o])}))]);return r.domain(n),r}function l(t,e){var r=parseFloat(t[o]);return"number"!=typeof r||isNaN(r)?"#CCC":e(r)}window.onload=(t=.5*window.innerWidth,e=d3.select("body").append("svg").attr("class","map").attr("width",t).attr("height",600),r=d3.geoAlbers().center([-10,50.78]).rotate([-20.8,0,0]).parallels([20.5,33.5]).scale(1100).translate([t/2,300]),n=d3.geoPath().projection(r),void d3.queue().defer(d3.csv,"data/EnvironmentalStatisticsEUFinal.csv").defer(d3.json,"data/RegionalCountries.topojson").defer(d3.json,"data/EUCountries.topojson").await((function(t,r,c,u){!function(t,e){var r=d3.geoGraticule().step([5,5]);t.append("path").datum(r.outline()).attr("class","gratBackground").attr("d",e),t.selectAll(".gratLines").data(r.lines()).enter().append("path").attr("class","gratLines").attr("d",e)}(e,n);var d=topojson.feature(c,c.objects.RegionalCountries),p=topojson.feature(u,u.objects.EUCountries).features;e.append("path").datum(d).attr("class","regional").attr("d",n),p=function(t,e){for(var r=["GHG","Waste","TotalEner","NonRenewEner","WaterAbsAvg"],n=0;n<e.length;n++)for(var a=e[n],o=a.Code,i=0;i<t.length;i++){var s=t[i].properties;s.GeogCode==o&&r.forEach((function(t){var e=parseFloat(a[t]);s[t]=e}))}return t}(p,r);var f=s(r);!function(t,e,r,n){e.selectAll(".EuropeanUnionCountries").data(t).enter().append("path").attr("class",(function(t){return"EuropeanUnionCountries "+t.properties.GeogCode})).attr("d",r).style("fill",(function(t){return l(t.properties,n)}))}(p,e,n,f),function(t,e){var r=.425*window.innerWidth,n=473,a=25,i=5,s=r-a-2,c=n-2*i,u="translate("+a+","+i+")",d=d3.select("body").append("svg").attr("width",r).attr("height",n).attr("class","chart"),p=(d.append("rect").attr("class","chartBackground").attr("width",s).attr("height",c).attr("transform",u),d3.scaleLinear().range([463,0]).domain([0,100])),f=(d.selectAll(".bar").data(t).enter().append("rect").sort((function(t,e){return t[o]-e[o]})).attr("class",(function(t){return"bars "+t.Code})).attr("width",s/t.length-1).attr("x",(function(e,r){return r*(s/t.length)+a})).attr("height",(function(t,e){return 463-p(parseFloat(t[o]))})).attr("y",(function(t,e){return p(parseFloat(t[o]))+i})).style("fill",(function(t){return l(t,e)})),d.selectAll(".numbers").data(t).enter().append("text").sort((function(t,e){return t[o]-e[o]})).attr("class",(function(t){return"numbers "+t.Code})).attr("text-anchor","middle").attr("width",s/t.length-1).attr("x",(function(e,r){return r*(s/t.length)+35})).attr("height",(function(t,e){return 463-p(parseFloat(t[o]))})).attr("y",(function(t,e){return p(parseFloat(t[o]))+20})).text((function(t){return t[o]})),d.append("text").attr("x",40).attr("y",40).attr("class","chartTitle").text("Number of "+o+" per capita in each country"),d3.axisLeft(p));d.append("g").attr("class","axis").attr("transform",u).call(f),d.append("rect").attr("class","chartFrame").attr("width",s).attr("height",c).attr("transform",u)}(r,f),function(t){var e=d3.select("body").append("select").attr("class","dropdown").on("change",(function(){i(this.value,t)}));e.append("option").attr("class","titleOption").attr("disabled","true").text("Select Attribute"),e.selectAll("attrOptions").data(a).enter().append("option").attr("value",(function(t){return t})).text((function(t){return t}))}(r),i(r)})))}();