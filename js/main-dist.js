!function(){var t,e,r,n,a=["Greenhouse_Gases","Total_Waste","Air_Quality","Non-Renewable_Energy","Freshwater_Extractions"],o=a[0],i=.425*window.innerWidth,s=i-25-2,l=d3.scaleLinear().range([463,0]).domain([0,300]);function u(t,e){o=t;var r=d(e),n=(d3.selectAll(".EuropeanUnionCountries").transition().duration(1e3).style("fill",(function(t){return p(t.properties,r)})),d3.selectAll(".bar").sort((function(t,e){return t[o]-e[o]})).transition().delay((function(t,e){return 20*e})).duration(500)),a=d3.selectAll(".numbers").sort((function(t,e){return t[o]-e[o]})).transition().delay((function(t,e){return 20*e})).duration(500);c(n,e.length,r,a)}function c(t,e,r,n){var a=null;if("Greenhouse_Gases"==o)a=30;if("Total_Waste"==o)a=28;if("Non-Renewable_Energy"==o)a=300;if("Freshwater_Extractions"==o)a=1450;if("Air_Quality"==o)a=30;var i=d3.scaleLinear().range([463,0]).domain([0,a]);t.attr("x",(function(t,r){return r*(s/e)+25})).attr("height",(function(t,e){return 463-i(parseFloat(t[o]))})).attr("y",(function(t,e){return i(parseFloat(t[o]))+5})).style("fill",(function(t){return p(t,r)})),n.attr("x",(function(t,r){return r*(s/e)+35})).attr("height",(function(t,e){return 463-i(parseFloat(t[o]))})).attr("y",(function(t,e){return i(parseFloat(t[o]))+15})).text((function(t){return t[o]}));d3.select(".chartTitle").text((function(t){return"Greenhouse_Gases"==o?"Greenhouse Gases Produced - Metric Tons Per Capita":"Total_Waste"==o?"Total Waste Produced – Metric Tons Per Capita":"Non-Renewable_Energy"==o?"Energy From Non-Renewable Sources - Gigajoules Per Capita":"Freshwater_Extractions"==o?"Extraction of Fresh Surface and Groundwater - Cubic Meters Per Capita":"Air_Quality"==o?"Fine Particulate Matter (PM2.5) - Micrograms Per Cubic Meter":void 0}))}function d(t){var e=d3.scaleQuantile().range(["#1a9850","#91cf60","#d9ef8b","#fee08b","#fc8d59","#d73027"]),r=[d3.min(t,(function(t){return parseFloat(t[o])})),d3.max(t,(function(t){return parseFloat(t[o])}))];return e.domain(r),e}function p(t,e){var r=parseFloat(t[o]);return"number"!=typeof r||isNaN(r)?"#CCC":e(r)}function f(t){d3.selectAll("."+t.Code).style("stroke","#41fdfe").style("stroke-width","2.5").style("fill-opacity",".6").style("stroke-opacity",".8");m(t)}function h(t){d3.selectAll("."+t.Code).style("stroke","black").style("stroke-width","0.75").style("fill-opacity","1").style("stroke-opacity","1"),d3.select(".infolabel").remove()}function m(t){var e=null;if("Greenhouse_Gases"==o)e="mt PC";if("Total_Waste"==o)e="mt PC";if("Non-Renewable_Energy"==o)e="GJ PC";if("Freshwater_Extractions"==o)e="m³ PC";if("Air_Quality"==o)e="µg/m³";var r="<h2>"+t[o]+"</h2><b>"+e+"</b>";d3.select("div.mapContainer").append("div").attr("class","infolabel").attr("id",t.Code+"_label").html(r).append("div").attr("class","labelname").html(t.Country)}function g(){var t=d3.select(".infolabel").node().getBoundingClientRect().width,e=d3.event.clientX+10,r=d3.event.clientY-75,n=d3.event.clientX-t-10,a=d3.event.clientY+25,o=d3.event.clientX>window.innerWidth-t-20?n:e,i=d3.event.clientY<75?a:r;d3.select(".infolabel").style("left",o+"px").style("top",i+"px")}window.onload=(t=.5*window.innerWidth,e=d3.select("div.mapContainer").append("svg").attr("class","map").attr("width",t).attr("height",550),r=d3.geoAlbers().center([-10,49.78]).rotate([-20.8,0,0]).parallels([20.5,33.5]).scale(1e3).translate([t/2,275]),n=d3.geoPath().projection(r),void d3.queue().defer(d3.csv,"data/EnvironmentalStatisticsEUFinal.csv").defer(d3.json,"data/RegionalCountries.topojson").defer(d3.json,"data/EUCountries.topojson").await((function(t,r,i,s){!function(t,e){var r=d3.geoGraticule().step([5,5]);t.append("path").datum(r.outline()).attr("class","gratBackground").attr("d",e),t.selectAll(".gratLines").data(r.lines()).enter().append("path").attr("class","gratLines").attr("d",e)}(e,n);var v=topojson.feature(i,i.objects.RegionalCountries),y=topojson.feature(s,s.objects.EUCountries).features;e.append("path").datum(v).attr("class","regional").attr("d",n),y=function(t,e){for(var r=["Greenhouse_Gases","Total_Waste","Air_Quality","Non-Renewable_Energy","Freshwater_Extractions"],n=0;n<e.length;n++)for(var a=e[n],o=a.Code,i=0;i<t.length;i++){var s=t[i].properties;s.Code==o&&r.forEach((function(t){var e=parseFloat(a[t]);s[t]=e}))}return t}(y,r);var C=d(r);!function(t,e,r,n){e.selectAll(".EuropeanUnionCountries").data(t).enter().append("path").attr("class",(function(t){return"EuropeanUnionCountries "+t.properties.Code})).attr("d",r).style("fill",(function(t){return p(t.properties,n)})).on("mouseover",(function(t){f(t.properties)})).on("mouseout",(function(t){h(t.properties)})).on("mousemove",g).append("desc").text('{"stroke": "#000", "stroke-width": "0.5px"}')}(y,e,n,C),function(t,e){var r=.425*window.innerWidth,n=545,a=25,i=5,s=r-a-2,u=n-2*i,d="translate("+a+","+i+")",p=d3.select("div.mapContainer").append("svg").attr("width",r).attr("height",n).attr("class","chart"),m=(p.append("rect").attr("class","chartBackground").attr("width",s).attr("height",u).attr("transform",d),p.selectAll(".bar").data(t).enter().append("rect").sort((function(t,e){return t[o]-e[o]})).attr("class",(function(t){return"bar "+t.Code})).attr("width",s/t.length-1).on("mouseover",f).on("mouseout",h).on("mousemove",g)),v=(m.append("desc").text('{"stroke": "none", "stroke-width": "0px"}'),p.selectAll(".numbers").data(t).enter().append("text").sort((function(t,e){return t[o]-e[o]})).attr("class",(function(t){return"numbers "+t.Code})).attr("text-anchor","middle").attr("width",s/t.length-1).attr("x",(function(e,r){return r*(s/t.length)+35})).attr("height",(function(t,e){return 463-l(parseFloat(t[o]))})).attr("y",(function(t,e){return l(parseFloat(t[o]))+10})).text((function(t){return t[o]})).on("mouseover",f).on("mouseout",h).on("mousemove",g));p.append("text").attr("x",40).attr("y",40).attr("class","chartTitle").text("Per Capita "+o+" in each country"),p.append("text").attr("x",40).attr("y",485).attr("class","chartLegend").text("EU Country by Value: Lower number is more environmentally friendly. Equal Interval Classification."),p.append("text").attr("x",40).attr("y",500).attr("class","chartLegend2").text("Choose variable in the upper left of the map. Hover over country or bar to see selected country and data value information. Map Projection is Albers Equal Area."),p.append("text").attr("x",40).attr("y",515).attr("class","chartLegend2").text("Majority of data from 2015-2018, courtesy EuroStat, United Nations, OECD and World Health Organization. See sources at the bottom of page for more details."),p.append("text").attr("x",40).attr("y",530).attr("class","chartLegend2").text("United Kingdom included as it was a member during data gathering period, but left the EU in 2020."),p.append("rect").attr("class","chartFrame").attr("width",s).attr("height",u).attr("transform",d),c(m,t.length,e,v)}(r,C),function(t){var e=d3.select("div.mapContainer").append("select").attr("class","dropdown").on("change",(function(){u(this.value,t)}));e.append("option").attr("class","titleOption").attr("disabled","true").text("Select Category"),e.selectAll("attrOptions").data(a).enter().append("option").attr("value",(function(t){return t})).text((function(t){return t.replaceAll("_"," ")})),m(props)}(r),u(r)})))}();